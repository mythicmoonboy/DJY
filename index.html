<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DJY COMMUNITY TOURNAMENT OFFICIAL WEBSITE</title>
    <style>
        :root { --red: #ff2b2b; --bg: #050505; --card: #121212; --border: #333; --gold: #ffd700; }
        body { margin:0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #fff; overflow-x: hidden; }
        
        header { background: #000; border-bottom: 2px solid var(--red); padding: 10px; text-align: center; position: sticky; top: 0; z-index: 1000; }
        header h1 { margin: 0; color: var(--red); text-transform: uppercase; letter-spacing: 2px; font-size: 1rem; }
        nav { display: flex; justify-content: center; gap: 20px; margin-top: 5px; }
        nav a { color: #888; text-decoration: none; font-weight: bold; cursor: pointer; font-size: 0.75rem; padding: 4px 8px; }
        nav a.active { color: var(--red); border-bottom: 2px solid var(--red); background: rgba(255, 43, 43, 0.1); }

        section { display: none; padding: 10px; height: calc(100vh - 80px); box-sizing: border-box; }
        section.active { display: block; }

        /* Button Press Effect */
        button { transition: all 0.1s ease; box-shadow: 0 3px 0 #8b0000; cursor: pointer; border-radius: 4px; border:none; }
        button:active { transform: translateY(2px); box-shadow: 0 1px 0 #8b0000; }

        .announcement-bar { background: var(--red); color: black; padding: 8px; text-align: center; font-weight: 900; text-transform: uppercase; font-size: 0.8rem; margin-bottom: 10px; border-radius: 4px; }
        
        .profile-pic { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--red); margin-bottom: 10px; object-fit: cover; }
        .description { color: #bbb; max-width: 700px; margin: auto; line-height: 1.5; text-align: center; font-size: 0.85rem; }

        /* Compact Tournament List */
        .division-title { color: var(--red); border-left: 4px solid var(--red); padding-left: 8px; margin: 15px 0 10px; text-transform: uppercase; font-size: 0.75rem; }
        .t-long-box { background: var(--card); border: 1px solid var(--border); padding: 15px 30px; margin-bottom: 10px; border-radius: 4px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .status-tag { font-size: 9px; padding: 2px 5px; border-radius: 3px; color: #fff; text-transform: uppercase; font-weight: bold; }

        /* ONE-PAGE BRACKET UI */
        .bracket-wrapper { position: relative; padding: 20px; min-width: 2400px; display: flex; flex-direction: column; gap: 20px; height: 100%; justify-content: center; }
        canvas#line-canvas { position: absolute; top: 0; left: 0; pointer-events: none; z-index: 1; }
        .bracket-row { display: flex; gap: 100px; align-items: stretch; position: relative; z-index: 2; height: 42%; }
        .round { display: flex; flex-direction: column; justify-content: space-around; width: 150px; }
        
        .match { background: #000; border: 1px solid var(--border); padding: 4px; margin: 2px 0; border-radius: 3px; }
        .team { display: flex; justify-content: space-between; font-size: 10px; padding: 3px; border-bottom: 1px solid #222; }
        .team input { background: transparent; border: none; color: white; width: 90px; font-size: 10px; }
        .score { color: var(--red); font-weight: bold; cursor: pointer; min-width: 15px; text-align: center; }
        .match.gf-box { border: 2px solid var(--gold); background: rgba(255, 215, 0, 0.05); }

        /* Admin Dashboard */
        .admin-box { width: 350px; margin: 20px auto; border: 1px solid var(--red); padding: 20px; background: #000; }
        .admin-box input, .admin-box select { width: 100%; padding: 10px; margin-bottom: 10px; background: #111; border: 1px solid #333; color: white; box-sizing: border-box; font-size: 0.8rem; }
        .admin-box button { width: 100%; padding: 10px; background: var(--red); color: #000; font-weight: bold; cursor: pointer; margin-bottom: 8px; font-size: 0.8rem; }
        .manage-item { background: #111; padding: 8px; margin-top: 8px; border: 1px solid #333; border-radius: 4px; font-size: 11px; }
    </style>
</head>
<body>

<header>
    <h1>DJY COMMUNITY TOURNAMENT</h1>
    <nav>
        <a onclick="tab('home')" id="n-home" class="active">HOME</a>
        <a onclick="tab('tour')" id="n-tour">TOURNAMENT</a>
        <a onclick="tab('admin')" id="n-admin">ADMIN</a>
    </nav>
</header>

<section id="home" class="active">
    <div id="top-ann" class="announcement-bar">Official DJY Tournament Hub</div>
    <div style="text-align:center;">
        <img src="https://yt3.googleusercontent.com" alt="DJY PFP" class="profile-pic">
        <h2 style="color:var(--red); font-size: 1.2rem; margin: 5px 0;">DJY: The Clipper of MLBB</h2>
        <p class="description">
            DJY is a premier Mobile Legends: Bang Bang YouTuber and professional MPL athlete. Known as the definitive <b>Clipper of MLBB</b>, he specialized in high-impact highlights before hosting professional-grade tournaments for the community.
        </p>
    </div>
</section>

<section id="tour">
    <div id="list-view" style="overflow-y: auto; max-height: 100%;">
        <div class="division-title">üî¥ LIVE</div><div id="live-list"></div>
        <div class="division-title">üìÖ UPCOMING</div><div id="upcoming-list"></div>
        <div class="division-title">üèÅ FINISHED</div><div id="finished-list"></div>
    </div>

    <div id="detail-view" style="display:none; height: 100%;">
        <button onclick="closeDetail()" style="background:#333; color:white; padding:8px; font-size: 0.7rem;">‚Üê BACK</button>
        <h2 id="det-name" style="color:var(--red); font-size: 1rem; margin: 5px 0; display: inline-block; margin-left: 20px;"></h2>
        <div style="overflow: auto; height: calc(100% - 40px);">
            <div class="bracket-wrapper" id="bracket-root">
                <canvas id="line-canvas"></canvas>
                <!-- Upper Row (42% Height) -->
                <div class="bracket-row">
                    <div class="round" id="R32"></div><div class="round" id="R16"></div>
                    <div class="round" id="R8"></div><div class="round" id="R4"></div>
                    <div class="round" id="GF"><div class="match gf-box" id="GF-0"></div></div>
                </div>
                <!-- Divider (Thin) -->
                <div style="height:1px; background:var(--border); margin: 5px 0;"></div>
                <!-- Lower Row (42% Height) -->
                <div class="bracket-row" id="lower-row">
                    <div class="round" id="LR1"></div><div class="round" id="LR2"></div>
                    <div class="round" id="LR3"></div><div class="round" id="LR4"></div>
                </div>
            </div>
        </div>
    </div>
</section>

<section id="admin">
    <div id="login-ui" class="admin-box">
        <h3 style="color:var(--red); text-align:center; font-size: 0.9rem;">ADMIN LOGIN</h3>
        <input id="user" placeholder="username"><input id="pass" type="password" placeholder="password">
        <button onclick="login()">LOGIN</button>
    </div>

    <div id="dash-ui" class="admin-box" style="display:none; width:500px; max-height: 100%; overflow-y: auto;">
        <h3 style="color:var(--red); text-align:center; font-size: 0.9rem;">COMMAND CENTER</h3>
        <div id="head-admin-tools" style="display:none; border:1px solid #222; padding:10px; margin-bottom:10px;">
            <h4 style="color:var(--red); font-size: 0.75rem; margin: 0 0 5px;">Staff Manager (moonboi)</h4>
            <input id="s-u" placeholder="New User"><input id="s-p" placeholder="New Pass">
            <button onclick="addStaff()">Create Staff</button>
            <div id="s-list"></div>
        </div>
        <div style="border:1px solid #222; padding:10px; margin-bottom:10px;">
            <h4 style="font-size: 0.75rem; margin: 0 0 5px;">Tournament Status</h4>
            <div id="admin-tour-manager"></div>
        </div>
        <div style="border:1px solid #222; padding:10px;">
            <h4 style="font-size: 0.75rem; margin: 0 0 5px;">Create Bracket</h4>
            <input id="t-n" placeholder="Name"><input id="t-p" placeholder="Prize">
            <select id="t-type"><option value="double">Double Elimination</option><option value="single">Single Elimination</option></select>
            <button onclick="createTour()">Generate R32</button>
        </div>
        <button onclick="logout()" style="background:#444; margin-top:10px;">LOGOUT</button>
    </div>
</section>

<script>
let accounts = JSON.parse(localStorage.getItem('djy_accs')) || [{u:"moonboi", p:"123", role:"head"}];
let tours = JSON.parse(localStorage.getItem('djy_tours')) || [];
let currentUser = JSON.parse(localStorage.getItem('djy_session')) || null;
let activeIdx = null;

function tab(id) {
    document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.getElementById('n-'+id).classList.add('active');
    if(id === 'tour') renderTours();
}

function checkSession() {
    if (currentUser) {
        document.getElementById('login-ui').style.display = 'none';
        document.getElementById('dash-ui').style.display = 'block';
        if(currentUser.role === 'head') document.getElementById('head-admin-tools').style.display = 'block';
        renderStaff(); renderAdminManager();
    }
}

function login() {
    let u = document.getElementById('user').value, p = document.getElementById('pass').value;
    let auth = accounts.find(a => a.u === u && a.p === p);
    if(auth) { currentUser = auth; localStorage.setItem('djy_session', JSON.stringify(auth)); checkSession(); }
}

function logout() { localStorage.removeItem('djy_session'); location.reload(); }

function createTour() {
    let name = document.getElementById('t-n').value; if(!name) return;
    tours.push({
        name, prize: document.getElementById('t-p').value, status: 'UPCOMING', type: document.getElementById('t-type').value,
        bracket: {
            R32: Array(16).fill().map((_,i)=>({t1:"Team "+(i*2+1), t2:"Team "+(i*2+2), s1:0, s2:0})),
            R16: Array(8).fill({t1:"TBD", t2:"TBD", s1:0, s2:0}), R8: Array(4).fill({t1:"TBD", t2:"TBD", s1:0, s2:0}),
            R4: Array(2).fill({t1:"TBD", t2:"TBD", s1:0, s2:0}), GF: [{t1:"UB Winner", t2:"LB Winner", s1:0, s2:0}],
            LR1: Array(8).fill({t1:"TBD", t2:"TBD", s1:0, s2:0}), LR2: Array(4).fill({t1:"TBD", t2:"TBD", s1:0, s2:0}),
            LR3: Array(2).fill({t1:"TBD", t2:"TBD", s1:0, s2:0}), LR4: [{t1:"TBD", t2:"TBD", s1:0, s2:0}]
        }
    });
    save(); renderAdminManager(); renderTours();
}

function renderTours() {
    const ids = { LIVE: 'live-list', UPCOMING: 'upcoming-list', FINISHED: 'finished-list' };
    Object.values(ids).forEach(id => { if(document.getElementById(id)) document.getElementById(id).innerHTML = ""; });
    tours.forEach((t, i) => {
        let color = t.status === 'LIVE' ? 'green' : (t.status === 'UPCOMING' ? 'orange' : '#555');
        document.getElementById(ids[t.status]).innerHTML += `<div class="t-long-box" onclick="openDetail(${i})"><h3>${t.name} <span class="status-tag" style="background:${color}">${t.status}</span></h3><span>${t.prize}</span></div>`;
    });
}

function openDetail(i) {
    activeIdx = i; document.getElementById('list-view').style.display = 'none'; document.getElementById('detail-view').style.display = 'block';
    document.getElementById('det-name').innerText = tours[i].name; 
    document.getElementById('lower-row').style.display = tours[i].type === 'double' ? 'flex' : 'none';
    renderBracket(); setTimeout(drawLines, 200);
}

function renderBracket() {
    const b = tours[activeIdx].bracket;
    const rounds = ["R32", "R16", "R8", "R4", "LR1", "LR2", "LR3", "LR4", "GF"];
    rounds.forEach(r => {
        const el = document.getElementById(r === 'GF' ? 'GF-0' : r); if(!el) return;
        el.innerHTML = "";
        let matches = r === 'GF' ? b.GF : b[r];
        matches.forEach((m, i) => {
            el.innerHTML += `<div class="match" id="${r}-${i}">
                <div class="team"><input value="${m.t1}" onchange="tours[activeIdx].bracket['${r}'][${i}].t1=this.value; save();" ${!currentUser?'disabled':''}> <div class="score" onclick="setS('${r}',${i},1)">${m.s1}</div></div>
                <div class="team"><input value="${m.t2}" onchange="tours[activeIdx].bracket['${r}'][${i}].t2=this.value; save();" ${!currentUser?'disabled':''}> <div class="score" onclick="setS('${r}',${i},2)">${m.s2}</div></div>
            </div>`;
        });
    });
}

function setS(r, i, n) {
    if(!currentUser) return;
    let s = prompt("Score:"); if(s === null) return;
    let b = tours[activeIdx].bracket;
    if(r === 'GF') b.GF[i]['s'+n] = s; else b[r][i]['s'+n] = s;
    save(); renderBracket(); drawLines();
}

function drawLines() {
    const canvas = document.getElementById('line-canvas'), root = document.getElementById('bracket-root');
    canvas.width = root.scrollWidth; canvas.height = root.scrollHeight;
    const ctx = canvas.getContext('2d'); ctx.strokeStyle = '#ff2b2b'; ctx.lineWidth = 1.5;
    
    const drawStraight = (fromId, toId) => {
        const fEl = document.getElementById(fromId), tEl = document.getElementById(toId);
        if(!fEl || !tEl) return;
        const fR = fEl.getBoundingClientRect(), tR = tEl.getBoundingClientRect(), rR = root.getBoundingClientRect();
        let x1 = fR.right - rR.left, y1 = fR.top + fR.height/2 - rR.top;
        let x2 = tR.left - rR.left, y2 = tR.top + tR.height/2 - rR.top;
        let midX = x1 + (x2 - x1) / 2;
        ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(midX, y1); ctx.lineTo(midX, y2); ctx.lineTo(x2, y2); ctx.stroke();
    };

    const b = tours[activeIdx].bracket;
    for(let i=0; i<16; i++) drawStraight(`R32-${i}`, `R16-${Math.floor(i/2)}`);
    for(let i=0; i<8; i++) drawStraight(`R16-${i}`, `R8-${Math.floor(i/2)}`);
    for(let i=0; i<4; i++) drawStraight(`R8-${i}`, `R4-${Math.floor(i/2)}`);
    drawStraight(`R4-0`, `GF-0`);
    if(tours[activeIdx].type === 'double') {
        for(let i=0; i<8; i++) drawStraight(`LR1-${i}`, `LR2-${Math.floor(i/2)}`);
        for(let i=0; i<4; i++) drawStraight(`LR2-${i}`, `LR3-${Math.floor(i/2)}`);
        for(let i=0; i<2; i++) drawStraight(`LR3-${i}`, `LR4-0`);
        drawStraight(`LR4-0`, `GF-0`);
    }
}

function save() { localStorage.setItem('djy_tours', JSON.stringify(tours)); }
function closeDetail() { document.getElementById('list-view').style.display='block'; document.getElementById('detail-view').style.display='none'; }
function addStaff() { accounts.push({u:document.getElementById('s-u').value, p:document.getElementById('s-p').value, role:'staff'}); localStorage.setItem('djy_accs', JSON.stringify(accounts)); renderStaff(); }
function renderStaff() { 
    const l = document.getElementById('s-list'); if(!l) return; l.innerHTML = "";
    accounts.forEach((a,i) => { if(a.role!=='head') l.innerHTML += `<div class="manage-item">${a.u} <button onclick="accounts.splice(${i},1); localStorage.setItem('djy_accs',JSON.stringify(accounts)); renderStaff();">X</button></div>`; });
}
function renderAdminManager() {
    const c = document.getElementById('admin-tour-manager'); if(!c) return; c.innerHTML = "";
    tours.forEach((t, i) => {
        c.innerHTML += `<div class="manage-item"><b>${t.name}</b><div style="display:flex; gap:3px; margin-top:5px;"><button onclick="updateStatus(${i},'LIVE')" style="font-size:9px; padding:3px; background:green; color:white;">LIVE</button><button onclick="updateStatus(${i},'UPCOMING')" style="font-size:9px; padding:3px; background:orange;">UPCOMING</button><button onclick="updateStatus(${i},'FINISHED')" style="font-size:9px; padding:3px; background:#555; color:white;">FINISH</button><button onclick="deleteTour(${i})" style="font-size:9px; padding:3px; background:red; color:white;">DEL</button></div></div>`;
    });
}
function updateStatus(i, s) { tours[i].status = s; save(); renderTours(); renderAdminManager(); }
function deleteTour(i) { if(confirm("DEL?")) { tours.splice(i,1); save(); renderTours(); renderAdminManager(); } }
checkSession(); renderTours();
</script>
</body>
</html>
