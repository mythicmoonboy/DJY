<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DJY COMMUNITY TOURNAMENT</title>
    <style>
        :root { --red: #ff2b2b; --bg: #050505; --card: #121212; --border: #2a2a2a; }
        body { margin:0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #fff; overflow-x: hidden; }
        
        /* Navigation */
        header { background: #000; border-bottom: 2px solid var(--red); padding: 15px; text-align: center; position: sticky; top: 0; z-index: 1000; }
        header h1 { margin: 0; color: var(--red); text-transform: uppercase; letter-spacing: 2px; font-size: 1.1rem; }
        nav { display: flex; justify-content: center; gap: 25px; margin-top: 10px; }
        nav a { color: #888; text-decoration: none; font-weight: bold; cursor: pointer; font-size: 0.8rem; }
        nav a.active { color: var(--red); border-bottom: 1px solid var(--red); }

        section { display: none; padding: 20px; min-height: 80vh; }
        section.active { display: block; }

        /* Home & Announcements */
        .announcement-bar { background: var(--red); color: black; padding: 10px; text-align: center; font-weight: 900; text-transform: uppercase; margin-bottom: 20px; border-radius: 4px; }
        .home-box { max-width: 800px; margin: auto; text-align: center; }

        /* Tournament List */
        .t-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .t-card { background: var(--card); border: 1px solid var(--border); padding: 20px; border-radius: 4px; cursor: pointer; }
        .t-card:hover { border-color: var(--red); }
        .t-card h3 { color: var(--red); margin: 0; }

        /* Professional Bracket View */
        #detail-view { display: none; overflow-x: auto; padding-bottom: 50px; }
        .bracket-scroll { display: flex; flex-direction: column; gap: 40px; min-width: 1600px; }
        .bracket-row { display: flex; gap: 40px; align-items: stretch; position: relative; }
        .round { display: flex; flex-direction: column; justify-content: space-around; width: 140px; gap: 10px; position: relative; }
        
        .match { background: #000; border: 1px solid var(--border); border-radius: 2px; position: relative; }
        .match::after { content: "➜"; position: absolute; right: -25px; top: 50%; transform: translateY(-50%); color: var(--red); font-size: 12px; }
        .round:last-child .match::after { display: none; }
        
        .team { display: flex; justify-content: space-between; padding: 4px 8px; font-size: 11px; border-bottom: 1px solid #222; }
        .team input { background: transparent; border: none; color: white; width: 90px; }
        .score { color: var(--red); font-weight: bold; cursor: pointer; min-width: 15px; text-align: center; }

        /* Admin UI */
        .admin-box { width: 320px; margin: 40px auto; border: 1px solid var(--red); padding: 25px; background: #000; }
        .admin-box input, .admin-box textarea { width: 100%; padding: 10px; margin-bottom: 10px; background: #111; border: 1px solid #333; color: white; box-sizing: border-box; }
        .admin-box button { width: 100%; padding: 12px; background: var(--red); border: none; font-weight: bold; cursor: pointer; margin-bottom: 5px; }
    </style>
</head>
<body>

<header>
    <h1>DJY COMMUNITY TOURNAMENT</h1>
    <nav>
        <a id="n-home" onclick="tab('home')" class="active">HOME</a>
        <a id="n-tour" onclick="tab('tour')">TOURNAMENT</a>
        <a id="n-admin" onclick="tab('admin')">ADMIN</a>
    </nav>
</header>

<section id="home" class="active">
    <div id="top-msg" class="announcement-bar">Welcome to DJY Community Arena</div>
    <div class="home-box">
        <h2 style="color:var(--red)">Who is DJY?</h2>
        <p>DJY is a premier MLBB YouTuber and professional community caster. He hosts the most competitive grassroots tournaments, providing a professional stage for every aspiring player.</p>
    </div>
</section>

<section id="tour">
    <div id="list-view">
        <div id="tournament-container" class="t-grid"></div>
    </div>
    
    <div id="detail-view">
        <button onclick="closeDetail()" style="background:#333; color:white; border:none; padding:10px; margin-bottom:20px; cursor:pointer;">← Back</button>
        <h2 id="d-name" style="color:var(--red)"></h2>
        <p id="d-meta" style="color:#888; font-size:0.9rem;"></p>

        <div class="bracket-scroll">
            <h4 style="color:var(--red); border-left:3px solid var(--red); padding-left:10px;">UPPER BRACKET (R32 START)</h4>
            <div class="bracket-row">
                <div class="round" id="UB1"></div><div class="round" id="UB2"></div><div class="round" id="UB3"></div><div class="round" id="UB4"></div><div class="round" id="UB5"></div>
            </div>
            
            <h4 style="color:var(--red); border-left:3px solid var(--red); padding-left:10px;">LOWER BRACKET (SURVIVAL)</h4>
            <div class="bracket-row">
                <div class="round" id="LB1"></div><div class="round" id="LB2"></div><div class="round" id="LB3"></div><div class="round" id="LB4"></div>
            </div>
        </div>
    </div>
</section>

<section id="admin">
    <!-- Login -->
    <div id="login" class="admin-box">
        <h3 style="color:var(--red); text-align:center;">ADMIN ACCESS</h3>
        <label style="font-size:10px; color:#666;">username:</label>
        <input id="user" type="text">
        <label style="font-size:10px; color:#666;">password:</label>
        <input id="pass" type="password">
        <button onclick="login()">LOGIN</button>
    </div>

    <!-- Dashboard -->
    <div id="dash" class="admin-box" style="display:none; width:500px;">
        <h3 style="color:var(--red); text-align:center;">COMMAND CENTER</h3>
        
        <div style="border:1px solid #222; padding:15px; margin-bottom:15px;">
            <h4 style="margin:0 0 10px 0;">Post Update</h4>
            <input id="upd-txt" placeholder="Announcement text...">
            <button onclick="postUpd()" style="font-size:12px;">Push to Home</button>
        </div>

        <div style="border:1px solid #222; padding:15px;">
            <h4 style="margin:0 0 10px 0;">Create New Tournament</h4>
            <input id="new-name" placeholder="Tournament Name">
            <input id="new-prize" placeholder="Prize (e.g., RM 500)">
            <input id="new-time" placeholder="Time/Date">
            <textarea id="new-desc" placeholder="Description"></textarea>
            <button onclick="createTour()" style="background:green;">Generate Tournament</button>
        </div>
        
        <button onclick="location.reload()" style="background:#444; margin-top:10px;">Logout</button>
    </div>
</section>

<script>
let currentUser = null;
let tournaments = JSON.parse(localStorage.getItem('djy_tours')) || [];

// Initial Bracket Schema
const getBlankBracket = () => ({
    UB1: Array(16).fill().map((_,i)=>({t1:"Team "+(i*2+1), t2:"Team "+(i*2+2), s1:0, s2:0})),
    UB2: Array(8).fill({t1:"TBD", t2:"TBD", s1:0, s2:0}),
    UB3: Array(4).fill({t1:"TBD", t2:"TBD", s1:0, s2:0}),
    UB4: Array(2).fill({t1:"TBD", t2:"TBD", s1:0, s2:0}),
    UB5: [{t1:"TBD", t2:"TBD", s1:0, s2:0}],
    LB1: Array(8).fill({t1:"TBD", t2:"TBD", s1:0, s2:0}),
    LB2: Array(4).fill({t1:"TBD", t2:"TBD", s1:0, s2:0}),
    LB3: Array(2).fill({t1:"TBD", t2:"TBD", s1:0, s2:0}),
    LB4: [{t1:"TBD", t2:"TBD", s1:0, s2:0}]
});

let activeTourIdx = null;

function tab(id) {
    document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.getElementById('n-'+id).classList.add('active');
    if(id === 'tour') renderTourList();
}

function login() {
    if(document.getElementById('user').value === "moonboi" && document.getElementById('pass').value === "123") {
        currentUser = "master";
        document.getElementById('login').style.display = 'none';
        document.getElementById('dash').style.display = 'block';
    }
}

function postUpd() {
    let msg = document.getElementById('upd-txt').value;
    document.getElementById('top-msg').innerText = msg.toUpperCase();
    localStorage.setItem('djy_ann', msg);
}

function createTour() {
    let name = document.getElementById('new-name').value;
    let prize = document.getElementById('new-prize').value;
    let time = document.getElementById('new-time').value;
    let desc = document.getElementById('new-desc').value;
    
    if(name) {
        tournaments.push({ name, prize, time, desc, bracket: getBlankBracket() });
        localStorage.setItem('djy_tours', JSON.stringify(tournaments));
        alert("Tournament Created!");
        renderTourList();
    }
}

function renderTourList() {
    const container = document.getElementById('tournament-container');
    container.innerHTML = "";
    tournaments.forEach((t, i) => {
        container.innerHTML += `
            <div class="t-card" onclick="openDetail(${i})">
                <h3>${t.name}</h3>
                <p style="font-size:0.8rem; color:#888;">Prize: ${t.prize} | ${t.time}</p>
            </div>
        `;
    });
}

function openDetail(idx) {
    activeTourIdx = idx;
    let t = tournaments[idx];
    document.getElementById('list-view').style.display = 'none';
    document.getElementById('detail-view').style.display = 'block';
    document.getElementById('d-name').innerText = t.name;
    document.getElementById('d-meta').innerText = `${t.prize} • ${t.time} • ${t.desc}`;
    renderBracket();
}

function closeDetail() {
    document.getElementById('list-view').style.display = 'block';
    document.getElementById('detail-view').style.display = 'none';
}

function updateScore(r, i, f, v) {
    let b = tournaments[activeTourIdx].bracket;
    if(f.startsWith('t')) b[r][i][f] = v;
    else {
        b[r][i][f] = v;
        let win = parseInt(b[r][i].s1) > parseInt(b[r][i].s2) ? b[r][i].t1 : b[r][i].t2;
        let lose = parseInt(b[r][i].s1) > parseInt(b[r][i].s2) ? b[r][i].t2 : b[r][i].t1;
        
        // Progression Logic
        if(r === 'UB1') advance(win, 'UB2', i);
        if(r === 'UB2') { advance(win, 'UB3', i); drop(lose, 'LB1', i); }
        if(r === 'UB3') { advance(win, 'UB4', i); drop(lose, 'LB2', i); }
    }
    localStorage.setItem('djy_tours', JSON.stringify(tournaments));
    renderBracket();
}

function advance(team, target, idx) {
    tournaments[activeTourIdx].bracket[target][Math.floor(idx/2)][(idx%2===0)?'t1':'t2'] = team;
}
function drop(team, target, idx) {
    tournaments[activeTourIdx].bracket[target][idx]['t1'] = team; // Simple drop logic
}

function renderBracket() {
    let b = tournaments[activeTourIdx].bracket;
    const rounds = ["UB1","UB2","UB3","UB4","UB5","LB1","LB2","LB3","LB4"];
    rounds.forEach(r => {
        const el = document.getElementById(r); if(!el) return;
        el.innerHTML = "";
        b[r].forEach((m, i) => {
            el.innerHTML += `<div class="match">
                <div class="team"><input value="${m.t1}" onchange="updateScore('${r}',${i},'t1',this.value)" ${!currentUser?'disabled':''}> <div class="score" onclick="setS('${r}',${i},1)">${m.s1}</div></div>
                <div class="team"><input value="${m.t2}" onchange="updateScore('${r}',${i},'t2',this.value)" ${!currentUser?'disabled':''}> <div class="score" onclick="setS('${r}',${i},2)">${m.s2}</div></div>
            </div>`;
        });
    });
}

function setS(r, i, t) { if(currentUser) { let s = prompt("Score:"); if(s) updateScore(r, i, 's'+t, s); } }

// Load Announcement
if(localStorage.getItem('djy_ann')) document.getElementById('top-msg').innerText = localStorage.getItem('djy_ann').toUpperCase();

renderTourList();
</script>
</body>
</html>
