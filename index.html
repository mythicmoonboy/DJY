<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DJY MLBB Tournament Pro</title>
    <style>
        :root { --red: #ff0000; --dark: #0b0b0b; --gray: #1a1a1a; --border: #333; }
        body { margin:0; font-family: 'Segoe UI', sans-serif; background: var(--dark); color: white; overflow-x: auto; }
        
        header { background: black; border-bottom: 3px solid var(--red); padding: 20px; text-align: center; position: sticky; top: 0; z-index: 100; }
        header h1 { margin: 0 0 10px 0; color: var(--red); text-transform: uppercase; letter-spacing: 2px; font-size: 1.5rem; }
        nav { display: flex; justify-content: center; gap: 20px; }
        nav a { color: white; text-decoration: none; font-weight: bold; cursor: pointer; font-size: 0.9rem; }
        nav a:hover { color: var(--red); }

        section { display: none; padding: 20px; min-width: 1400px; }
        section.active { display: block; }
        
        /* Bracket UI */
        .bracket-container { display: flex; justify-content: center; align-items: center; gap: 30px; padding: 40px 0; }
        .round { display: flex; flex-direction: column; justify-content: space-around; gap: 20px; width: 180px; }
        .round-title { text-align: center; color: var(--red); font-size: 0.7rem; font-weight: bold; margin-bottom: 10px; text-transform: uppercase; }
        
        .match { background: var(--gray); border: 1px solid var(--border); border-radius: 4px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        .team-row { display: flex; align-items: center; padding: 5px 10px; border-bottom: 1px solid #222; }
        .team-row:last-child { border-bottom: none; }
        .team-row input { background: transparent; border: none; color: white; flex-grow: 1; font-size: 0.8rem; padding: 5px; }
        .score-input { width: 30px; background: #222 !important; border: 1px solid var(--red) !important; color: var(--red) !important; text-align: center; font-weight: bold; border-radius: 2px; }

        .center-final { display: flex; flex-direction: column; align-items: center; width: 260px; }
        .trophy { font-size: 3rem; margin-bottom: 10px; text-shadow: 0 0 10px var(--red); }
        .gf-box { border: 2px solid gold; width: 100%; }

        /* Admin Styles */
        .admin-panel { background: var(--gray); padding: 25px; border-radius: 8px; max-width: 400px; margin: 40px auto; border: 1px solid var(--red); }
        .admin-panel h3 { margin-top: 0; color: var(--red); }
        input[type="text"], input[type="password"] { width: 100%; padding: 10px; margin: 10px 0; background: #222; border: 1px solid #444; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: var(--red); color: white; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-reset { background: #444; margin-top: 20px; font-size: 0.7rem; }
    </style>
</head>
<body>

<header>
    <h1>DJY MLBB TOURNAMENT</h1>
    <nav>
        <a onclick="show('home')">HOME</a>
        <a onclick="show('bracket')">BRACKET</a>
        <a onclick="show('tournaments')">TOURNAMENTS</a>
        <a onclick="show('admin')">ADMIN</a>
    </nav>
</header>

<section id="home" class="active">
    <div style="text-align: center; max-width: 800px; margin: auto;">
        <h2 style="color: var(--red);">Who is DJY?</h2>
        <p>DJY is a premier Mobile Legends: Bang Bang content creator and YouTuber, legendary for his high-stakes tournament hosting and analytical gameplay. He bridges the gap between grassroots players and the pro scene by providing a professional stage for every aspiring player.</p>
    </div>
</section>

<section id="bracket">
    <div class="bracket-container">
        <!-- LEFT SIDE (16 teams) -->
        <div class="round" id="L-R16"><div class="round-title">Left R16</div></div>
        <div class="round" id="L-R8"><div class="round-title">Left QF</div></div>
        <div class="round" id="L-R4"><div class="round-title">Left SF</div></div>

        <!-- CENTER GRAND FINAL -->
        <div class="center-final">
            <div class="trophy">üèÜ</div>
            <div class="round-title" style="color:gold">Grand Final</div>
            <div class="match gf-box" id="GF-MATCH"></div>
        </div>

        <!-- RIGHT SIDE (16 teams) -->
        <div class="round" id="R-R4"><div class="round-title">Right SF</div></div>
        <div class="round" id="R-R8"><div class="round-title">Right QF</div></div>
        <div class="round" id="R-R16"><div class="round-title">Right R16</div></div>
    </div>
    <div style="text-align:center" id="reset-zone"></div>
</section>

<section id="tournaments">
    <div style="max-width: 600px; margin: auto; border-left: 4px solid var(--red); background: var(--gray); padding: 20px;">
        <h3 style="color: var(--red); margin: 0;">DJY Community Tournament Season 2</h3>
        <p><strong>Prize Pool:</strong> RM 500 + Stream Donation</p>
        <p>A professional platform for community teams to shine. Matches are broadcast live with professional casting.</p>
    </div>
</section>

<section id="admin">
    <div id="login-form" class="admin-panel">
        <h3>Admin Access</h3>
        <input id="user" placeholder="Username">
        <input id="pass" type="password" placeholder="Password">
        <button onclick="login()">Login</button>
    </div>
    <div id="admin-dashboard" class="admin-panel" style="display:none">
        <h3>Admin Dashboard</h3>
        <p>Logged in as: <b id="current-user"></b></p>
        <div id="master-tools" style="display:none; border-top: 1px solid #444; padding-top: 15px;">
            <h4>Create Staff Account</h4>
            <input id="new-user" placeholder="Staff Username">
            <input id="new-pass" placeholder="Staff Password">
            <button onclick="addStaff()" style="background: green;">Add Staff Account</button>
        </div>
        <button onclick="logout()" class="btn-reset">Logout</button>
    </div>
</section>

<script>
// --- CONFIG & STATE ---
let currentUser = null;
let accounts = JSON.parse(localStorage.getItem('djy_accs')) || [{u:"moonboi", p:"123", role:"master"}];

// Bracket Structure: side-round-index
let bracketData = JSON.parse(localStorage.getItem('djy_bracket_v2')) || {
    "L-R16": Array(8).fill().map((_,i)=>({t1:`Team ${i*2+1}`, t2:`Team ${i*2+2}`, s1:0, s2:0})),
    "L-R8": Array(4).fill().map(()=>({t1:"TBD", t2:"TBD", s1:0, s2:0})),
    "L-R4": Array(2).fill().map(()=>({t1:"TBD", t2:"TBD", s1:0, s2:0})),
    "R-R16": Array(8).fill().map((_,i)=>({t1:`Team ${i*2+17}`, t2:`Team ${i*2+18}`, s1:0, s2:0})),
    "R-R8": Array(4).fill().map(()=>({t1:"TBD", t2:"TBD", s1:0, s2:0})),
    "R-R4": Array(2).fill().map(()=>({t1:"TBD", t2:"TBD", s1:0, s2:0})),
    "GF": [{t1:"TBD", t2:"TBD", s1:0, s2:0}]
};

// --- AUTH ---
function login() {
    let u = document.getElementById('user').value;
    let p = document.getElementById('pass').value;
    let acc = accounts.find(a => a.u === u && a.p === p);
    if(acc) {
        currentUser = acc;
        document.getElementById('login-form').style.display = 'none';
        document.getElementById('admin-dashboard').style.display = 'block';
        document.getElementById('current-user').innerText = u;
        if(acc.role === 'master') {
            document.getElementById('master-tools').style.display = 'block';
            document.getElementById('reset-zone').innerHTML = `<button class="btn-reset" onclick="resetBracket()">Full Bracket Reset</button>`;
        }
        render();
    }
}

function addStaff() {
    let u = document.getElementById('new-user').value;
    let p = document.getElementById('new-pass').value;
    if(u && p) {
        accounts.push({u, p, role:"staff"});
        localStorage.setItem('djy_accs', JSON.stringify(accounts));
        alert('Staff account created!');
    }
}

function logout() { location.reload(); }

// --- CORE BRACKET LOGIC ---
function updateVal(round, idx, field, val) {
    bracketData[round][idx][field] = val;
    
    // Auto-Winner Progression Logic
    if(field === 's1' || field === 's2') {
        let match = bracketData[round][idx];
        let winner = "TBD";
        if(parseInt(match.s1) > parseInt(match.s2)) winner = match.t1;
        else if(parseInt(match.s2) > parseInt(match.s1)) winner = match.t2;

        advanceWinner(round, idx, winner);
    }
    save();
    render();
}

function advanceWinner(currentRound, matchIdx, winnerName) {
    let nextRound = "";
    let nextMatchIdx = Math.floor(matchIdx / 2);
    let teamPos = (matchIdx % 2 === 0) ? 't1' : 't2';

    if(currentRound === "L-R16") nextRound = "L-R8";
    else if(currentRound === "L-R8") nextRound = "L-R4";
    else if(currentRound === "L-R4") { nextRound = "GF"; nextMatchIdx = 0; teamPos = 't1'; }
    else if(currentRound === "R-R16") nextRound = "R-R8";
    else if(currentRound === "R-R8") nextRound = "R-R4";
    else if(currentRound === "R-R4") { nextRound = "GF"; nextMatchIdx = 0; teamPos = 't2'; }

    if(nextRound) bracketData[nextRound][nextMatchIdx][teamPos] = winnerName;
}

function render() {
    const rounds = ["L-R16", "L-R8", "L-R4", "R-R4", "R-R8", "R-R16", "GF"];
    rounds.forEach(r => {
        let container = r === "GF" ? document.getElementById("GF-MATCH") : document.getElementById(r);
        let title = container.querySelector('.round-title')?.outerHTML || "";
        container.innerHTML = title;

        bracketData[r].forEach((m, i) => {
            let div = document.createElement('div');
            div.className = "match";
            div.innerHTML = `
                <div class="team-row">
                    <input type="text" value="${m.t1}" onchange="updateVal('${r}',${i},'t1',this.value)" ${!currentUser?'disabled':''}>
                    <input type="text" class="score-input" value="${m.s1}" onchange="updateVal('${r}',${i},'s1',this.value)" ${!currentUser?'disabled':''}>
                </div>
                <div class="team-row">
                    <input type="text" value="${m.t2}" onchange="updateVal('${r}',${i},'t2',this.value)" ${!currentUser?'disabled':''}>
                    <input type="text" class="score-input" value="${m.s2}" onchange="updateVal('${r}',${i},'s2',this.value)" ${!currentUser?'disabled':''}>
                </div>
            `;
            container.appendChild(div);
        });
    });
}

function save() { localStorage.setItem('djy_bracket_v2', JSON.stringify(bracketData)); }
function show(id) { document.querySelectorAll('section').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
function resetBracket() { if(confirm("Reset all scores and teams?")) { localStorage.removeItem('djy_bracket_v2'); location.reload(); } }

render();
</script>
</body>
</html>
