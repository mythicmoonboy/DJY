<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DJY COMMUNITY TOURNAMENT</title>
    <style>
        :root { --red: #ff2b2b; --bg: #050505; --card: #121212; --border: #2a2a2a; }
        body { margin:0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #fff; overflow-x: hidden; }
        
        header { background: #000; border-bottom: 2px solid var(--red); padding: 15px; text-align: center; position: sticky; top: 0; z-index: 1000; }
        header h1 { margin: 0; color: var(--red); text-transform: uppercase; letter-spacing: 2px; font-size: 1.1rem; }
        nav { display: flex; justify-content: center; gap: 25px; margin-top: 10px; }
        nav a { color: #888; text-decoration: none; font-weight: bold; cursor: pointer; font-size: 0.8rem; }
        nav a.active { color: var(--red); border-bottom: 1px solid var(--red); }

        section { display: none; padding: 20px; min-height: 85vh; }
        section.active { display: block; }

        /* Home & Scrolling Announcement */
        .announcement-bar { background: var(--red); color: black; padding: 10px; text-align: center; font-weight: 900; text-transform: uppercase; margin-bottom: 20px; border-radius: 4px; overflow: hidden; }
        
        /* Tournament "Long Box" UI */
        .t-long-box { background: var(--card); border: 1px solid var(--border); padding: 15px 30px; margin-bottom: 15px; border-radius: 4px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: 0.3s; }
        .t-long-box:hover { border-color: var(--red); background: #1a1a1a; }
        .t-long-box h3 { color: var(--red); margin: 0; text-transform: uppercase; letter-spacing: 1px; }

        /* SVG Progression Lines */
        #svg-connectors { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        .bracket-view { position: relative; display: flex; gap: 60px; padding: 40px; min-width: 2000px; }
        .round { display: flex; flex-direction: column; justify-content: space-around; width: 160px; gap: 15px; z-index: 2; }
        .match { background: #000; border: 1px solid var(--border); border-radius: 2px; padding: 5px; position: relative; }
        .team { display: flex; justify-content: space-between; font-size: 10px; padding: 3px 5px; border-bottom: 1px solid #222; }
        .score { color: var(--red); font-weight: bold; cursor: pointer; }

        /* Admin UI */
        .admin-box { width: 350px; margin: 40px auto; border: 1px solid var(--red); padding: 30px; background: #000; }
        .admin-box input { width: 100%; padding: 10px; margin-bottom: 15px; background: #111; border: 1px solid #333; color: white; box-sizing: border-box; }
        .admin-box button { width: 100%; padding: 12px; background: var(--red); border: none; font-weight: bold; cursor: pointer; margin-bottom: 8px; }
        .staff-list-item { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #222; font-size: 12px; }
    </style>
</head>
<body>

<header>
    <h1>DJY COMMUNITY TOURNAMENT</h1>
    <nav>
        <a onclick="tab('home')" id="n-home" class="active">HOME</a>
        <a onclick="tab('tour')" id="n-tour">TOURNAMENT</a>
        <a onclick="tab('admin')" id="n-admin">ADMIN</a>
    </nav>
</header>

<!-- HOME TAB -->
<section id="home" class="active">
    <div id="top-announcement" class="announcement-bar">Welcome to DJY Professional Arena</div>
    <div style="text-align:center; max-width:700px; margin:auto;">
        <h2 style="color:var(--red)">Meet DJY</h2>
        <p>DJY is a leading MLBB community host and professional YouTuber. This platform is designed to track progression for the elite community tournaments he hosts, featuring the M7 World Championship double-elimination format.</p>
    </div>
</section>

<!-- TOURNAMENT TAB -->
<section id="tour">
    <div id="list-view"></div>
    <div id="detail-view" style="display:none;">
        <button onclick="closeDetail()" style="background:#333; color:white; border:none; padding:10px; cursor:pointer; margin-bottom:20px;">← Back to Tournaments</button>
        <h2 id="det-name" style="color:var(--red); margin:0;"></h2>
        <div style="overflow-x:auto;">
            <div class="bracket-view" id="bracket-grid">
                <svg id="svg-connectors"></svg>
                <div class="round" id="R32"></div>
                <div class="round" id="R16"></div>
                <div class="round" id="R8"></div>
                <div class="round" id="R4"></div>
                <div class="round" id="GF"></div>
            </div>
        </div>
    </div>
</section>

<!-- ADMIN TAB -->
<section id="admin">
    <div id="login-ui" class="admin-box">
        <h3 style="color:var(--red); text-align:center;">ADMIN LOGIN</h3>
        <input id="user" placeholder="username">
        <input id="pass" type="password" placeholder="password">
        <button onclick="login()">LOGIN</button>
    </div>

    <div id="dash-ui" class="admin-box" style="display:none; width:600px;">
        <h3 id="dash-title" style="color:var(--red); text-align:center;"></h3>
        
        <div style="border:1px solid #222; padding:15px; margin-bottom:15px;">
            <h4>Post New Update</h4>
            <input id="upd-in" placeholder="Enter marquee text...">
            <button onclick="postUpdate()">Push to Home</button>
        </div>

        <div id="super-admin-tools" style="display:none; border:1px solid #222; padding:15px; margin-bottom:15px;">
            <h4 style="color:var(--red)">Head Admin Tools</h4>
            <input id="new-staff-u" placeholder="New Staff Username">
            <input id="new-staff-p" placeholder="New Staff Password">
            <button onclick="createStaff()" style="background:green">Create Account</button>
            <div id="staff-list" style="margin-top:15px;"></div>
        </div>

        <div style="border:1px solid #222; padding:15px;">
            <h4>Create New Tournament</h4>
            <input id="t-name" placeholder="Tournament Name">
            <input id="t-prize" placeholder="Prize Pool">
            <input id="t-time" placeholder="Start Date/Time">
            <button onclick="createTour()">Generate Bracket</button>
        </div>
        <button onclick="location.reload()" style="background:#333; margin-top:15px;">Logout</button>
    </div>
</section>

<script>
// --- AUTH & ROLES ---
let accounts = JSON.parse(localStorage.getItem('djy_accs')) || [{u:"moonboi", p:"123", role:"head"}];
let currentUser = null;

function login() {
    let u = document.getElementById('user').value;
    let p = document.getElementById('pass').value;
    let auth = accounts.find(a => a.u === u && a.p === p);
    if(auth) {
        currentUser = auth;
        document.getElementById('login-ui').style.display = 'none';
        document.getElementById('dash-ui').style.display = 'block';
        document.getElementById('dash-title').innerText = "WELCOME, " + u.toUpperCase();
        if(auth.role === 'head') {
            document.getElementById('super-admin-tools').style.display = 'block';
            renderStaffList();
        }
    }
}

function createStaff() {
    let u = document.getElementById('new-staff-u').value;
    let p = document.getElementById('new-staff-p').value;
    if(u && p) {
        accounts.push({u, p, role:'staff'});
        localStorage.setItem('djy_accs', JSON.stringify(accounts));
        renderStaffList();
    }
}

function kickStaff(idx) { accounts.splice(idx, 1); localStorage.setItem('djy_accs', JSON.stringify(accounts)); renderStaffList(); }

function renderStaffList() {
    const list = document.getElementById('staff-list');
    list.innerHTML = "";
    accounts.forEach((a, i) => {
        if(a.role !== 'head') {
            list.innerHTML += `<div class="staff-list-item"><span>${a.u}</span><button onclick="kickStaff(${i})" style="padding:2px 5px; font-size:10px; background:gray;">KICK</button></div>`;
        }
    });
}

// --- TOURNAMENT ENGINE ---
let tours = JSON.parse(localStorage.getItem('djy_tours')) || [];
let activeTourIdx = null;

function tab(id) {
    document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.getElementById('n-'+id).classList.add('active');
    if(id === 'tour') renderLongBoxes();
}

function createTour() {
    let name = document.getElementById('t-name').value;
    if(name) {
        tours.push({ 
            name, 
            prize: document.getElementById('t-prize').value, 
            time: document.getElementById('t-time').value,
            bracket: {
                R32: Array(16).fill().map((_,i)=>({t1:"Team "+(i*2+1), t2:"Team "+(i*2+2), s1:0, s2:0, id:`r32-${i}`})),
                R16: Array(8).fill({t1:"TBD", t2:"TBD", s1:0, s2:0}),
                R8: Array(4).fill({t1:"TBD", t2:"TBD", s1:0, s2:0}),
                R4: Array(2).fill({t1:"TBD", t2:"TBD", s1:0, s2:0}),
                GF: [{t1:"TBD", t2:"TBD", s1:0, s2:0}]
            }
        });
        localStorage.setItem('djy_tours', JSON.stringify(tours));
        alert("Tournament Generated!");
    }
}

function renderLongBoxes() {
    const view = document.getElementById('list-view');
    view.innerHTML = "";
    tours.forEach((t, i) => {
        view.innerHTML += `<div class="t-long-box" onclick="openDetail(${i})"><h3>${t.name}</h3><span style="font-size:12px; color:#888;">${t.prize} • ${t.time}</span></div>`;
    });
}

function openDetail(idx) {
    activeTourIdx = idx;
    document.getElementById('list-view').style.display = 'none';
    document.getElementById('detail-view').style.display = 'block';
    document.getElementById('det-name').innerText = tours[idx].name;
    renderBracket();
}

function closeDetail() {
    document.getElementById('list-view').style.display = 'block';
    document.getElementById('detail-view').style.display = 'none';
}

function postUpdate() {
    let msg = document.getElementById('upd-in').value;
    document.getElementById('top-announcement').innerText = msg.toUpperCase();
}

function renderBracket() {
    const b = tours[activeTourIdx].bracket;
    const rounds = ["R32", "R16", "R8", "R4", "GF"];
    rounds.forEach(r => {
        const el = document.getElementById(r);
        el.innerHTML = "";
        b[r].forEach((m, i) => {
            el.innerHTML += `<div class="match" id="${r}-${i}">
                <div class="team"><input value="${m.t1}" onchange="updateMatch('${r}',${i},'t1',this.value)" ${!currentUser?'disabled':''}> <div class="score" onclick="setScore('${r}',${i},1)">${m.s1}</div></div>
                <div class="team"><input value="${m.t2}" onchange="updateMatch('${r}',${i},'t2',this.value)" ${!currentUser?'disabled':''}> <div class="score" onclick="setScore('${r}',${i},2)">${m.s2}</div></div>
            </div>`;
        });
    });
}

function updateMatch(r, i, f, v) {
    tours[activeTourIdx].bracket[r][i][f] = v;
    localStorage.setItem('djy_tours', JSON.stringify(tours));
}

function setScore(r, i, tNum) {
    if(!currentUser) return;
    let s = prompt("Enter Score:");
    if(s !== null) {
        tours[activeTourIdx].bracket[r][i]['s'+tNum] = s;
        localStorage.setItem('djy_tours', JSON.stringify(tours));
        renderBracket();
    }
}

renderLongBoxes();
</script>
</body>
</html>
